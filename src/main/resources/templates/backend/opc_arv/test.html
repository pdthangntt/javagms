<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" data-layout-decorate="~{backend/layouts/main}">
    <head>
        <title th:utext="${title}" ></title>
    </head>
    <body>
        <div class="content-wrapper" role="main" data-layout-fragment="content">
            <script th:inline="javascript" 
                    th:with="currenUser=${#request.userPrincipal.principal.user}, 
                    currentSite=${#request.userPrincipal.principal.site}">
                        var options = [[${
                            options
                        }
                        ]];
                        var arv = [[${arv}
                        ]];
                        var currentSiteID = [[${currentSiteID}
                        ]];
                        var isOpcManager = [[${isOpcManager}
                        ]];
                        var current_user_name = [[${currenUser.name}
                        ]];
                        var urlIndex = [[${T(com.gms.components.UrlUtils).opcTest(arv.ID, tab)}
                        ]];
                        var urlGet = '/service/opc-test/get.json';
                        var urlNew = '/service/opc-test/new.json';
                        var urlUpdate = '/service/opc-test/update.json';
                        var urlLogs = '/service/opc-test/logs.json';
                        var urlLogCreate = '/service/opc-test/log-create.json';
            </script>
            <section class="content-header">
                <h1>
                    <a th:href="${T(com.gms.components.UrlUtils).opcIndex()}" class="btn btn-default" ><i class="fa fa-backward"></i> Quay lại</a>
                    <span>Bệnh án</span>
                    <b th:text="${'#' + arv.code}" class="text-danger text-uppercase" ></b>
                    <a class="btn btn-success btn-xs table-function"
                       th:href="${T(com.gms.components.UrlUtils).opcTestNew(arvID)}">
                        <i class="fa fa-plus"></i> 
                        Thêm lượt xét nghiệm
                    </a>
                </h1>
                <ol class="breadcrumb">
                    <li><a th:href="${T(com.gms.components.UrlUtils).home()}"><i class="fa fa-dashboard"></i> Trang chủ</a></li>
                    <li><a th:href="${T(com.gms.components.UrlUtils).opcIndex()}"><span th:text="${T(com.gms.entity.constant.BreadCrumbEnum).OPC_ARV.getLabel()}"></span></a></li>
                    <li>
                        <a th:href="${T(com.gms.components.UrlUtils).opcTest(arv.ID, 'all')}">
                            <span th:text="${title}" ></span>
                        </a>
                    </li>
                </ol>
            </section>
            <section class="content" ng-controller="opc_test" ng-init="init()">
                <div class="row">
                    <div class="col-lg-12 col-md-12" data-th-include="backend/layouts/widget-message :: widget-message" ></div>
                    <div class="col-lg-12 col-md-12" data-th-include="backend/opc_arv/widget :: opc-tab('other', ${arv.ID})" ></div>
                    <div class="col-md-12">
                        <div class="nav-tabs-custom">
                            <div class="tab-content">
                                <div class="active">
                                    <div class="row" >
                                        <div class="col-md-12">
                                            <div id="tableFunction" class="pull-right">
                                                <div data-th-include="widget/gridview :: default-action" ></div>
                                            </div>
                                        </div>
                                        <div class="col-md-12 margin-top-10">
                                            <table ng-cloak class="table table-striped table-bordered table-sm table-full" 
                                                   data-scrollY="auto" data-rightColumns="0" data-leftColumns="0">
                                                <thead>
                                                    <tr class="text-center vertical-align-middle success">
                                                        <th class="text-center" ><input type="checkbox" id="checkbox-switch-all" /></th>
                                                        <th class="text-center">Giai đoạn điều trị</th>
                                                        <th class="text-center">Trạng thái điều trị</th>
                                                        <th class="text-center">Sàng lọc Lao</th>
                                                        <th class="text-center">Điều trị Lao</th>
                                                        <th class="text-center">Điều trị dự phòng Lao (INH)</th>
                                                        <th class="text-center">Điều trị NTCH</th>
                                                        <th class="text-center">Xét nghiệm CD4</th>
                                                        <th class="text-center">Xét nghiệm viêm gan</th>
                                                        <th class="text-center" style="min-width: 120px;">Ghi chú</th>
                                                        <th class="text-center">Chức năng</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="entity : ${models}"
                                                        th:class="${success_id != null && success_id == entity.ID ? 'success' : '' }"
                                                        th:data-id="${entity.ID}">
                                                        <td class="text-center">
                                                            <input type="checkbox" class="checkbox-switch" th:value="${entity.ID}" />
                                                        </td>
                                                        <td class="" th:utext="${stagePatients.get(entity.stageID + '')}"></td>
                                                        <td class="" th:utext="${options.get(T(com.gms.entity.db.ParameterEntity).STATUS_OF_TREATMENT).get(entity.statusOfTreatmentID)}"></td>
                                                        <td class="text-left vertical-align-top">
                                                            <p>
                                                                Sàng lọc Lao:
                                                                <b th:if="${entity.lao}" class="text-success">[[${options.get('has').get(entity.lao == false ? '0' : '1')}]]</b>
                                                                <b th:if="${!entity.lao}" class="text-danger">[[${options.get('has').get(entity.lao == false ? '0' : '1')}]]</b>
                                                            </p>
                                                            <div th:if="${entity.lao}">
                                                                <p>
                                                                    Ngày sàng lọc:
                                                                    <span th:text="${entity.laoTestTime == null ? '__' : #dates.format(entity.laoTestTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                                <p>
                                                                    Các biểu hiện nghi Lao:
                                                                    <span th:if="${entity.laoSymptoms == null}">__</span>
                                                                    <span th:if="${entity.laoSymptoms != null}" th:each="item,i : ${entity.laoSymptoms}">
                                                                        <br/>
                                                                        &nbsp;&nbsp;<i class='fa fa-angle-right' ></i>  [[${options.get(T(com.gms.entity.db.ParameterEntity).LAO_SYMTOM).get(item)}]]
                                                                    </span>
                                                                </p>
                                                                <p>
                                                                    <span>Triệu chứng khác:</span>
                                                                    <span th:text="${entity.laoOtherSymptom == null || entity.laoOtherSymptom == '' ? '__' : entity.laoOtherSymptom}"></span>
                                                                </p>
                                                                <p>
                                                                    <span>Triệu chứng nghi ngờ:</span>
                                                                    <span>[[${entity.suspiciousSymptoms == null || entity.suspiciousSymptoms == '' ? '__' : options.get(T(com.gms.entity.db.ParameterEntity).SUSPICIOUS_SYMPTOMS).get(entity.suspiciousSymptoms + '')}]]</span>
                                                                </p>
                                                                <p>
                                                                    <span>CG khám và XN Lao:</span>
                                                                    <span>[[${options.get('has').get(entity.examinationAndTest == false ? '0' : entity.examinationAndTest == true ? '1' : '' )}]]</span>
                                                                </p><p>
                                                                    <span>Ngày xét nghiệm Lao:</span>
                                                                    <span>[[${entity.laoTestDate == null ? '__' : T(com.gms.components.TextUtils).formatDate(entity.laoTestDate, 'dd/MM/yyyy')}]]</span>
                                                                </p><p>
                                                                    <span>Kết quả XN Lao:</span>
                                                                    <span>[[${entity.laoResult == null || entity.laoResult == '' ? '__' : options.get(T(com.gms.entity.db.ParameterEntity).TEST_RESULTS).get(entity.laoResult)}]]</span>
                                                                </p><p>
                                                                    <span>Loại hình Lao:</span>
                                                                    <span>[[${entity.laoDiagnose == null || entity.laoDiagnose == '' ? '__' : options.get(T(com.gms.entity.db.ParameterEntity).LAO_DIAGNOSE).get(entity.laoDiagnose + '')}]]</span>
                                                                </p>
                                                            </div>

                                                        </td>
                                                        <td class="text-left vertical-align-top">
                                                            <p>
                                                                <span>Điều trị Lao:</span>
                                                                <b th:if="${entity.laoTreatment}" class="text-success">[[${options.get('has').get(entity.laoTreatment == false ? '0' : '1')}]]</b>
                                                                <b th:if="${!entity.laoTreatment}" class="text-danger">[[${options.get('has').get(entity.laoTreatment == false ? '0' : '1')}]]</b>
                                                            </p>
                                                            <p th:if="${entity.laoTreatment == true}">
                                                                <span>Ngày điều trị:</span>
                                                                <span th:if="${entity.laoStartTime != null}">Từ [[${T(com.gms.components.TextUtils).formatDate(entity.laoStartTime, 'dd/MM/yyyy')}]]</span>
                                                                <span th:if="${entity.laoEndTime != null}"> đến [[${T(com.gms.components.TextUtils).formatDate(entity.laoEndTime, 'dd/MM/yyyy')}]]</span>
                                                                <span th:if="${entity.laoStartTime == null}">__</span>
                                                            </p>
                                                        </td>
                                                        <td class="text-left vertical-align-top">
                                                            <p>
                                                                Dự phòng INH:
                                                                <b th:if="${entity.inh}" class="text-success">[[${options.get('has').get(entity.inh == false ? '0' : '1')}]]</b>
                                                                <b th:if="${!entity.inh}" class="text-danger">[[${options.get('has').get(entity.inh == false ? '0' : '1')}]]</b>
                                                            </p>
                                                            <div th:if="${entity.inh}">
                                                                <p>
                                                                    Ngày điều trị:
                                                                    <span th:if="${entity.inhFromTime != null || entity.inhToTime != null}">
                                                                        <span th:if="${entity.inhFromTime != null}" th:text="${entity.inhFromTime == null ? '__' : 'Từ ' + #dates.format(entity.inhFromTime, 'dd/MM/yyyy')}" ></span>
                                                                        <span th:if="${entity.inhToTime != null}" th:text="${entity.inhToTime == null ? '__' : 'đến ' + #dates.format(entity.inhToTime, 'dd/MM/yyyy')}" ></span>
                                                                    </span>
                                                                    <span  th:if="${entity.inhFromTime == null && entity.inhToTime == null}">__</span>
                                                                </p>
                                                                <p>
                                                                    Lý do kết thúc:
                                                                    <span th:if="${entity.inhEndCauses == null}">__</span>
                                                                    <span th:if="${entity.inhEndCauses != null}" th:each="item,i : ${entity.inhEndCauses}">
                                                                        <br/>
                                                                        &nbsp;&nbsp;<i class='fa fa-angle-right' ></i>  <span>[[${options.get(T(com.gms.entity.db.ParameterEntity).LAO_END_CASE).get(item)}]]</span>
                                                                    </span>
                                                                </p>
                                                            </div>
                                                        </td>
                                                        <td class="text-left vertical-align-top">
                                                            <p>
                                                                Điều trị NTCH:
                                                                <b th:if="${entity.ntch}" class="text-success">[[${options.get('has').get(entity.ntch == false ? '0' : '1')}]]</b>
                                                                <b th:if="${!entity.ntch}" class="text-danger">[[${options.get('has').get(entity.ntch == false ? '0' : '1')}]]</b>
                                                            </p>
                                                            <p>
                                                                Điều trị Cotrimoxazole:
                                                                <span th:if="${entity.cotrimoxazoleFromTime != null || entity.cotrimoxazoleToTime != null}">
                                                                    <span th:if="${entity.cotrimoxazoleFromTime != null}" th:text="${entity.cotrimoxazoleFromTime == null ? '__' : 'Từ ' + #dates.format(entity.cotrimoxazoleFromTime, 'dd/MM/yyyy')}" ></span>
                                                                    <span th:if="${entity.cotrimoxazoleToTime != null}" th:text="${entity.cotrimoxazoleToTime == null ? '__' : 'đến ' + #dates.format(entity.cotrimoxazoleToTime, 'dd/MM/yyyy')}" ></span>
                                                                </span>
                                                                <span  th:if="${entity.cotrimoxazoleFromTime == null && entity.cotrimoxazoleToTime == null}">__</span>
                                                            </p>

                                                            <div th:if="${entity.ntch}">

                                                                <p>
                                                                    Các biểu hiện NTCH:
                                                                    <span th:if="${entity.ntchSymptoms == null}">__</span>
                                                                    <span th:if="${entity.ntchSymptoms != null}" th:each="item,i : ${entity.ntchSymptoms}">
                                                                        <br/>
                                                                        &nbsp;&nbsp;<i class='fa fa-angle-right' ></i> <span>[[${options.get(T(com.gms.entity.db.ParameterEntity).NTCH_SYMTOM).get(item)}]]</span>
                                                                    </span>
                                                                </p>
                                                                <p>
                                                                    <span>Triệu chứng khác:</span>
                                                                    <span>[[${entity.ntchOtherSymptom == null || entity.ntchOtherSymptom == '' ? '__' : entity.ntchOtherSymptom}]]</span>
                                                                </p>
                                                            </div>
                                                            <p>
                                                                Lý do kết thúc:
                                                                <span th:if="${entity.cotrimoxazoleEndCauses == null}">__</span>
                                                                <span th:if="${entity.cotrimoxazoleEndCauses != null}" th:each="item,i : ${entity.cotrimoxazoleEndCauses}">
                                                                    <br/>
                                                                    &nbsp;&nbsp;<i class='fa fa-angle-right' ></i> <span>[[${item == '-1' ? entity.cotrimoxazoleOtherEndCause : options.get(T(com.gms.entity.db.ParameterEntity).NTCH_END_CASE).get(item)}]]</span>
                                                                </span>
                                                            </p>
                                                        </td>
                                                        <td class="text-left vertical-align-top">
                                                            <p>
                                                                Xét nghiệm CD4:
                                                                <b th:if="${entity.cd4TestTime != null}" class="text-success">Có</b>
                                                                <b th:if="${entity.cd4TestTime == null}" class="text-danger">Không</b>
                                                            </p>
                                                            <div th:if="${entity.cd4TestTime != null}">
                                                                <p>
                                                                    Ngày lấy mẫu:
                                                                    <span th:text="${entity.cd4SampleTime == null ? '__' : #dates.format(entity.cd4SampleTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                                <p>
                                                                    Ngày xét nghiệm:
                                                                    <span th:text="${entity.cd4TestTime == null ? '__' : #dates.format(entity.cd4TestTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                                <p>
                                                                    Lý do xét nghiệm:
                                                                    <span th:if="${entity.cd4Causes == null}">__</span>
                                                                    <span th:if="${entity.cd4Causes != null}" th:each="item,i : ${entity.cd4Causes}">
                                                                        <br/>
                                                                        &nbsp;&nbsp;<i class='fa fa-angle-right' ></i> <span>[[${options.get(T(com.gms.entity.db.ParameterEntity).CD4_SYMTOM).get(item)}]]</span>
                                                                    </span>
                                                                </p>
                                                                <p>
                                                                    <span>Nơi xét nghiệm:</span>
                                                                    <span>[[${entity.cd4TestSiteID == null || entity.cd4TestSiteID == 0 ? '__' : entity.cd4TestSiteID == -1 ? entity.cd4TestSiteName : options.get('siteCd4').get(entity.cd4TestSiteID + '')}]]</span>
                                                                </p>
                                                                <p>
                                                                    <span>Kết quả xét nghiệm:</span>
                                                                    <span>[[${entity.cd4Result == null || entity.cd4Result == '' ? '__' : entity.cd4Result}]]</span>
                                                                </p>
                                                                <p>
                                                                    Ngày nhận kết quả:
                                                                    <span th:text="${entity.cd4ResultTime == null ? '__' : #dates.format(entity.cd4ResultTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                                <p>
                                                                    Ngày hẹn xét nghiệm:
                                                                    <span th:text="${entity.cd4RetryTime == null ? '__' : #dates.format(entity.cd4RetryTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                            </div>

                                                        </td>
                                                        <td class="text-left vertical-align-top">
                                                            <p>
                                                                Xét nghiệm HBV:
                                                                <b th:if="${entity.hbv}" class="text-success">[[${options.get('has').get(entity.hbv == false ? '0' : '1')}]]</b>
                                                                <b th:if="${!entity.hbv}" class="text-danger">[[${options.get('has').get(entity.hbv == false ? '0' : '1')}]]</b>
                                                            </p>
                                                            <div th:if="${entity.hbv}">
                                                                <p>
                                                                    Ngày xét nghiệm HBV:
                                                                    <span th:text="${entity.hbvTime == null ? '__' : #dates.format(entity.hbvTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                                <p>
                                                                    <span>Kết quả XN HBV:</span>
                                                                    <span>[[${entity.hbvResult == null || entity.hbvResult == '' ? '__' : options.get(T(com.gms.entity.db.ParameterEntity).TEST_RESULTS).get(entity.hbvResult)}]]</span>
                                                                </p>
                                                                <p>
                                                                    <span>Lý do XN HBV:</span>
                                                                    <span>[[${entity.hbvCase == null || entity.hbvCase == '' ? '__' : entity.hbvCase}]]</span>
                                                                </p>
                                                            </div>
                                                            <p>
                                                                Xét nghiệm HCV:
                                                                <b th:if="${entity.hcv}" class="text-success">[[${options.get('has').get(entity.hcv == false ? '0' : '1')}]]</b>
                                                                <b th:if="${!entity.hcv}" class="text-danger">[[${options.get('has').get(entity.hcv == false ? '0' : '1')}]]</b>
                                                            </p>
                                                            <div th:if="${entity.hcv}">
                                                                <p>
                                                                    Ngày xét nghiệm HCV:
                                                                    <span th:text="${entity.hcvTime == null ? '__' : #dates.format(entity.hcvTime, 'dd/MM/yyyy')}"></span>
                                                                </p>
                                                                <p>
                                                                    <span>Kết quả XN HCV:</span>
                                                                    <span>[[${entity.hcvResult == null || entity.hcvResult == '' ? '__' : options.get(T(com.gms.entity.db.ParameterEntity).TEST_RESULTS).get(entity.hcvResult)}]]</span>
                                                                </p>
                                                                <p>
                                                                    <span>Lý do XN HCV:</span>
                                                                    <span>[[${entity.hcvCase == null || entity.hcvCase == '' ? '__' : entity.hcvCase}]]</span>
                                                                </p>
                                                            </div>

                                                        </td>
                                                        <td class="text-center" style="vertical-align:top">
                                                            <p>
                                                                <span>[[${entity.note == null ? '' : entity.note}]]</span>
                                                            </p>

                                                        </td>

                                                        <td class="text-right" >
                                                            <a th:class="${(siteID == entity.siteID && arv.ID == entity.arvID) || arv.ID == entity.arvID ? 'btn btn-default btn-xs table-function' : 'btn btn-default btn-xs table-function disabled'}"
                                                               th:if="${tab != 'deleted'}"
                                                               th:href="${T(com.gms.components.UrlUtils).opcTestView(arvID, entity.ID)}">
                                                                <i class="fa fa-eye"></i> Xem 
                                                            </a>
                                                            <a th:class="${(siteID == entity.siteID && arv.ID == entity.arvID) || arv.ID == entity.arvID ? 'btn btn-default btn-xs table-function' : 'btn btn-default btn-xs table-function disabled'}"
                                                               th:if="${tab != 'deleted'}"
                                                               th:href="${T(com.gms.components.UrlUtils).opcTestUpdate(arvID, entity.ID)}">
                                                                <i class="fa fa-edit"></i> Sửa 
                                                            </a>
                                                            <a th:class="${(siteID == entity.siteID && arv.ID == entity.arvID) || arv.ID == entity.arvID ? 'btn btn-danger btn-xs table-function' : 'btn btn-danger btn-xs table-function disabled'}"
                                                               th:if="${tab != 'deleted'}"
                                                               th:href="${T(com.gms.components.UrlUtils).opcTestRemove(arvID, entity.ID)}"
                                                               data-confirm="Bạn chắc chắn muốn xóa lượt xét nghiệm này không?">
                                                                <i class="fa fa-remove"></i> Xoá
                                                            </a>
                                                            <a th:class="${(siteID == entity.siteID && arv.ID == entity.arvID) || arv.ID == entity.arvID ? 'btn btn-primary btn-xs table-function' : 'btn btn-primary btn-xs table-function disabled'}"
                                                               th:if="${tab == 'deleted'}"
                                                               th:href="${T(com.gms.components.UrlUtils).opcTestRestore(arvID, entity.ID)}"
                                                               data-confirm="Bạn chắc chắn muốn khôi phục lượt xét nghiệm này?">
                                                                <i class="fa  fa-undo"></i> Khôi phục
                                                            </a>
                                                            <a th:class="${(siteID == entity.siteID && arv.ID == entity.arvID) || arv.ID == entity.arvID ? 'btn btn-danger btn-xs table-function' : 'btn btn-danger btn-xs table-function disabled'}"
                                                               th:if="${tab == 'deleted' && !isOpcManager}"
                                                               th:href="${T(com.gms.components.UrlUtils).opcTestDelete(arvID, entity.ID)}"
                                                               data-confirm="Bạn chắc chắn muốn xóa vĩnh viễn lượt xét nghiệm này không?">
                                                                <i class="fa fa-remove"></i> Xoá vĩnh viễn
                                                            </a>
                                                            <a th:class="${(siteID == entity.siteID && arv.ID == entity.arvID) || arv.ID == entity.arvID ? 'btn btn-default btn-xs table-function' : 'btn btn-default btn-xs table-function disabled'}"
                                                               th:attr="ng-click='logs('+${entity.ID}+')'">
                                                                <i class="fa fa-comment"></i> Lịch sử
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row" >
                                        <div class="col-md-12 text-right margin-top-10">
                                            <a th:if="${tab != 'all'}" th:href="${T(com.gms.components.UrlUtils).opcTest(arv.ID, 'all')}" class="btn btn-sm btn-default">DS tất cả</a>
                                            <a th:if="${tab != 'deleted'}" th:href="${T(com.gms.components.UrlUtils).opcTest(arv.ID, 'deleted')}" class="btn btn-sm btn-danger">DS đã xoá</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <script type="text/ng-template" id="opcTest">
                <div class="modal-header">
                <button ng-click="cancel()" type="button" class="close" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                {{formTitle}} bệnh án <b class="text-danger " >#{{arv.code}}</b>
                </h4>
                </div>
                <div class="modal-body" ng-init="init()">
                <form id="testForm">
                <label class="text-bold">Thông tin sàng lọc, điều trị dự phòng Lao và nhiễm trùng cơ hội</label>
                <fieldset class="form-fieldset">
                <div class="row">
                <div class="col-md-3">
                <div ng-class="errors.lao?'has-error form-group':'form-group'">
                <label>Sàng lọc Lao: <span class="text-danger"></span></label>
                <select ng-model="item.lao" id="lao" 
                ng-options="key as value for (key , value) in options['has']"
                class="form-control">
                </select>
                <p class="help-block" ng-if="errors.lao">{{errors.lao}}</p>
                </div>
                </div>
                <div class="col-md-3">
                <div ng-class="errors.laoTestTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày sàng lọc: <span class="text-danger"></span></label>
                <input id="laoTestTime" type="text" ng-model="item.laoTestTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.laoTestTime">{{errors.laoTestTime}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.laoSymptoms?'has-error form-group':'form-group'">
                <label>Các biểu hiện nghi Lao: <span class="text-danger"></span></label>
                <select id="laoSymptoms" class="form-control">
                    <option ng-repeat="(key, val) in options['lao-symtom']" value="{{key}}">{{val}}</option>
                </select>
                <p class="help-block" ng-if="errors.laoSymptoms">{{errors.laoSymptoms}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.laoOtherSymptom ? 'has-error form-group' : 'form-group'">
                <label>Triệu chứng khác: </label>
                <input id="laoOtherSymptom" type="text" ng-model="item.laoOtherSymptom"  class="form-control" />
                <p class="help-block" ng-if="errors.laoOtherSymptom">{{errors.laoOtherSymptom}}</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div ng-class="errors.laoResult?'has-error form-group':'form-group'">
                <label>Kết quả sàng lọc Lao: <span class="text-danger"></span></label>
                <select ng-model="item.laoResult" id="laoResult" 
                        ng-options="key as value for (key , value) in options['test-results']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.laoResult">{{errors.laoResult}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.laoTreatment?'has-error form-group':'form-group'">
                <label>Điều trị Lao: <span class="text-danger"></span></label>
                <select ng-model="item.laoTreatment" id="laoTreatment" 
                        ng-options="key as value for (key , value) in options['has']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.laoTreatment">{{errors.laoTreatment}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.laoStartTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày bắt đầu điều trị Lao: <span class="text-danger"></span></label>
                <input id="laoStartTime" type="text" ng-model="item.laoStartTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.laoStartTime">{{errors.laoStartTime}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.laoEndTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày kết thúc điều trị Lao: <span class="text-danger"></span></label>
                <input id="laoEndTime" type="text" ng-model="item.laoEndTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.laoEndTime">{{errors.laoEndTime}}</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div ng-class="errors.inh?'has-error form-group':'form-group'">
                <label>Điều trị dự phòng INH: <span class="text-danger"></span></label>
                <select ng-model="item.inh" id="inh" 
                        ng-options="key as value for (key , value) in options['has']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.inh">{{errors.inh}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.inhFromTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày bắt đầu INH: <span class="text-danger"></span></label>
                <input id="inhFromTime" type="text" ng-model="item.inhFromTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.inhFromTime">{{errors.inhFromTime}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.inhToTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày kết thúc INH: <span class="text-danger"></span></label>
                <input id="inhToTime" type="text" ng-model="item.inhToTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.inhToTime">{{errors.inhToTime}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.inhEndCauses?'has-error form-group':'form-group'">
                <label>Lý do kết thúc: <span class="text-danger"></span></label>
                <select id="inhEndCauses" class="form-control">
                    <option ng-repeat="(key, val) in options['lao-end-case']" value="{{key}}">{{val}}</option>
                </select>
                <p class="help-block" ng-if="errors.inhEndCauses">{{errors.inhEndCauses}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div ng-class="errors.ntch?'has-error form-group':'form-group'">
                <label>Điều trị NTCH: <span class="text-danger"></span></label>
                <select ng-model="item.ntch" id="ntch" 
                        ng-options="key as value for (key , value) in options['has']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.ntch">{{errors.ntch}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.ntchSymptoms?'has-error form-group':'form-group'">
                <label>Các biểu hiện nghi NTCH: <span class="text-danger"></span></label>
                <select id="ntchSymptoms" class="form-control">
                    <option ng-repeat="(key, val) in options['ntch-symtom']" value="{{key}}">{{val}}</option>
                </select>
                <p class="help-block" ng-if="errors.ntchSymptoms">{{errors.ntchSymptoms}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.ntchOtherSymptom ? 'has-error form-group' : 'form-group'">
                <label>Triệu chứng khác: </label>
                <input id="ntchOtherSymptom" type="text" ng-model="item.ntchOtherSymptom"  class="form-control" />
                <p class="help-block" ng-if="errors.ntchOtherSymptom">{{errors.ntchOtherSymptom}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div ng-class="errors.cotrimoxazoleFromTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày bắt đầu Cotrimoxazole: <span class="text-danger"></span></label>
                <input id="cotrimoxazoleFromTime" type="text" ng-model="item.cotrimoxazoleFromTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.cotrimoxazoleFromTime">{{errors.cotrimoxazoleFromTime}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cotrimoxazoleToTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày kết thúc Cotrimoxazole: <span class="text-danger"></span></label>
                <input id="cotrimoxazoleToTime" type="text" ng-model="item.cotrimoxazoleToTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.cotrimoxazoleToTime">{{errors.cotrimoxazoleToTime}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cotrimoxazoleEndCauses?'has-error form-group':'form-group'">
                <label>Lý do kết thúc: <span class="text-danger"></span></label>
                <select id="cotrimoxazoleEndCauses" class="form-control">
                    <option ng-repeat="(key, val) in options['ntch-end-case']" value="{{key}}">{{val}}</option>
                </select>
                <p class="help-block" ng-if="errors.cotrimoxazoleEndCauses">{{errors.cotrimoxazoleEndCauses}}</p>
            </div>
        </div>
    </div>
</fieldset>
<label class="text-bold">Thông tin xét nghiệm CD4</label>
<fieldset class="form-fieldset">
    <div class="row">
        <div class="col-md-4">
            <div ng-class="errors.cd4SampleTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày lấy mẫu: <span class="text-danger"></span></label>
                <input type="text" ng-model="item.cd4SampleTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.cd4SampleTime">{{errors.cd4SampleTime}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cd4TestTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày xét nghiệm: <span class="text-danger"></span></label>
                <input type="text" ng-model="item.cd4TestTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.cd4TestTime">{{errors.cd4TestTime}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cd4Causes?'has-error form-group':'form-group'">
                <label>Lý do xét nghiệm: <span class="text-danger"></span></label>
                <select id="cd4Causes" class="form-control">
                    <option ng-repeat="(key, val) in options['cd4-symtom']" value="{{key}}">{{val}}</option>
                </select>
                <p class="help-block" ng-if="errors.cd4Causes">{{errors.cd4Causes}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div ng-show="!readonly || (item.cd4TestSiteID != null && item.cd4TestSiteID != '')" ng-class="errors.cd4TestSiteID?'has-error form-group':'form-group'">
                <label>Nơi xét nghiệm: <span class="text-danger"></span></label>
                <select ng-model="item.cd4TestSiteID" id="cd4TestSiteID" name="cd4TestSiteID"
                        ng-options="key as value for (key , value) in options['siteCd4']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.cd4TestSiteID">{{errors.cd4TestSiteID}}</p>
            </div>
            <div ng-show="readonly && (item.cd4TestSiteID == null || item.cd4TestSiteID == '')" ng-class="errors.cd4TestSiteID?'has-error form-group':'form-group'">
                <label>Nơi xét nghiệm: <span class="text-danger"></span></label>
                <input  type="text" disabled  class="form-control" />
                <p class="help-block" ng-if="errors.cd4TestSiteID">{{errors.cd4TestSiteID}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cd4TestSiteName ? 'has-error form-group' : 'form-group'">
                <label>Khác (Ghi rõ): </label>
                <input id="cd4TestSiteName" type="text" ng-model="item.cd4TestSiteName"  class="form-control" />
                <p class="help-block" ng-if="errors.cd4TestSiteName">{{errors.cd4TestSiteName}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cd4Result ? 'has-error form-group' : 'form-group'">
                <label>Kết quả xét nghiệm: </label>
                <input type="text" ng-model="item.cd4Result"  class="form-control" />
                <small class="form-text text-muted">Đơn vị đo: Tế bào/mm<sup>3</sup></small>
                <p class="help-block" ng-if="errors.cd4Result">{{errors.cd4Result}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div ng-class="errors.cd4ResultTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày nhận kết quả: <span class="text-danger"></span></label>
                <input type="text" ng-model="item.cd4ResultTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.cd4ResultTime">{{errors.cd4ResultTime}}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div ng-class="errors.cd4RetryTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày hẹn xét nghiệm: <span class="text-danger"></span></label>
                <input type="text" ng-model="item.cd4RetryTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.cd4RetryTime">{{errors.cd4RetryTime}}</p>
            </div>
        </div>
    </div>

</fieldset>
<label class="text-bold">Thông tin xét nghiệm viêm gan</label>
<fieldset class="form-fieldset">
    <div class="row">
        <div class="col-md-3">
            <div ng-class="errors.hbv?'has-error form-group':'form-group'">
                <label>Xét nghiệm HBV: <span class="text-danger"></span></label>
                <select ng-model="item.hbv" id="hbv" 
                        ng-options="key as value for (key , value) in options['has']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.hbv">{{errors.hbv}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.hbvTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày xét nghiệm HBV: <span class="text-danger"></span></label>
                <input id="hbvTime" type="text" ng-model="item.hbvTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.hbvTime">{{errors.hbvTime}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-show="!readonly || (item.hbvResult != null && item.hbvResult != '')" ng-class="errors.hbvResult?'has-error form-group':'form-group'">
                <label>Kết quả XN HBV: <span class="text-danger"></span></label>
                <select ng-model="item.hbvResult" id="hbvResult" 
                        ng-options="key as value for (key , value) in options['test-results']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.hbvResult">{{errors.hbvResult}}</p>
            </div>
            <div ng-show="readonly && (item.hbvResult == null || item.hbvResult == '')" ng-class="errors.hbvResult?'has-error form-group':'form-group'">
                <label>Kết quả XN HBV: <span class="text-danger"></span></label>
                <input  type="text" disabled  class="form-control" />
                <p class="help-block" ng-if="errors.hbvResult">{{errors.hbvResult}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.hbvCase ? 'has-error form-group' : 'form-group'">
                <label>Lý do XN HBV: </label>
                <input  id="hbvCase" type="text" ng-model="item.hbvCase"  class="form-control" />
                <p class="help-block" ng-if="errors.hbvCase">{{errors.hbvCase}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div ng-class="errors.hcv?'has-error form-group':'form-group'">
                <label>Xét nghiệm HCV: <span class="text-danger"></span></label>
                <select ng-model="item.hcv" id="hcv" 
                        ng-options="key as value for (key , value) in options['has']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.hcv">{{errors.hcv}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.hcvTime ? 'has-error form-group' : 'form-group'">
                <label>Ngày xét nghiệm HCV: <span class="text-danger"></span></label>
                <input id="hcvTime" type="text" ng-model="item.hcvTime" ui-mask="99/99/9999" placeholder="dd/mm/yyyy" class="form-control" />
                <p class="help-block" ng-if="errors.hcvTime">{{errors.hcvTime}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-show="!readonly || (item.hcvResult != null && item.hcvResult != '')" ng-class="errors.hcvResult?'has-error form-group':'form-group'">
                <label>Kết quả XN HCV: <span class="text-danger"></span></label>
                <select ng-model="item.hcvResult" id="hcvResult" 
                        ng-options="key as value for (key , value) in options['test-results']"
                        class="form-control">
                </select>
                <p class="help-block" ng-if="errors.hcvResult">{{errors.hcvResult}}</p>
            </div>
            <div ng-show="readonly && (item.hcvResult == null || item.hcvResult == '')" ng-class="errors.hcvResult?'has-error form-group':'form-group'">
                <label>Kết quả XN HCV: <span class="text-danger"></span></label>
                <input  type="text" disabled  class="form-control" />
                <p class="help-block" ng-if="errors.hcvResult">{{errors.hcvResult}}</p>
            </div>
        </div>
        <div class="col-md-3">
            <div ng-class="errors.hcvCase ? 'has-error form-group' : 'form-group'">
                <label>Lý do XN HCV: </label>
                <input id="hcvCase" type="text" ng-model="item.hcvCase"  class="form-control" />
                <p class="help-block" ng-if="errors.hcvCase">{{errors.hcvCase}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div ng-class="errors.note?'has-error form-group':'form-group'">
                <label>Ghi chú: </label>
                <textarea  type="text" ng-model="item.note" class="form-control" />
                <p class="help-block" ng-if="errors.note">{{errors.note}}</p>
            </div>
        </div>
    </div>
</fieldset>
</form>
</div>
<div class="modal-footer">
    <button ng-if="!readonly" class="btn btn-primary" type="button" ng-click="ok()" ng-show="item.action != 'view'" ><i class="fa  fa-floppy-o"></i> &nbsp;Lưu thông tin</button>
    <button class="btn btn-default" type="button" ng-click="cancel()"><span >{{!readonly ? 'Hủy' : 'Đóng'}}</span></button>
</div>
            </script>
            <script type="text/ng-template" id="opcTestLogs">
                <div class="modal-header">
                <button ng-click="cancel()" type="button" class="close" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Lịch sử xét nghiệm bệnh án<span class="text-danger " > #{{model.code}}</span></h4>
                </div>
                <div class="modal-body popup-note">
                <table class="table table-hover table-sm table-striped table-bordered">
                <tbody>
                <tr>
                <th class="text-center">Thời gian</th>
                <th class="text-center">Nhân viên</th>
                <th  class="text-center">Nội dung</th>
                </tr>
                <tr ng-if="!logs.length">
                <td class="text-danger text-center" colspan="3">Chưa có ghi chép nào</td>
                </tr>
                <tr ng-repeat="log in logs">
                <td class="text-center">{{log.time| date:'h:mma dd/MM/yyyy'}}</td>
                <td class="text-center">{{log.staffId===0?'Hệ thống':log.staffID}}</td>
                <td style="word-break: break-all;" ng-bind-html="log.content"></td>
                </tr>
                </tbody>
                </table>
                </div>
                <!-- /.box-body -->
                <div class="box-footer clearfix">
                <div class="pull-right">
                <div ng-class="errors.content ? 'has-error form-group' : 'form-group'">
                <div class="input-group input-group-sm">
                <input ng-model="model.content" type="text" class="form-control"
                ng-enter="add()"
                placeholder="Ghi chú thêm"/>
                <span class="input-group-btn">
                <button ng-click="add()" type="button" class="btn btn-success btn-flat">
                <i class="fa fa-plus"></i> Thêm ghi chú
                </button>
                </span>
                </div>
                <p class="help-block" ng-if="errors.content">{{errors.content[0]}}</p>
                </div>
                </div>
                </div>
                <div class="modal-footer">
                <button class="btn btn-primary" type="button" ng-click="cancel()">Đóng</button>
                </div>
            </script>
        </div>
    </body>
</html>
